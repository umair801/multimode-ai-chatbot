<!-- extends "layout.html" means: "layout.html" is a parent file -->
{% extends 'layout.html' %}
{% block content %}

<div class="container mt-4" style="max-width: 1000px;">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        <i class="bi bi-image me-2"></i>Professional AI Image Generator
                    </h4>
                    <small class="text-muted">Generate images for client presentations, portfolio projects, and professional work</small>
                </div>
                <div class="card-body">
                    
                    <!-- Image Generation Form -->
                    <form action="/image" method="POST" id="imageForm">
                        <div class="mb-3">
                            <label for="user_input" class="form-label">Image Description</label>
                            <textarea class="form-control" name="user_input" id="user_input" rows="3" 
                                    placeholder="Describe the image you want to generate... (e.g., 'A professional data visualization chart showing machine learning accuracy metrics for a client presentation')"
                                    required></textarea>
                        </div>
                        
                        <!-- Style Presets -->
                        <div class="mb-3">
                            <label class="form-label">Style Presets</label>
                            <div class="btn-group-toggle d-flex flex-wrap gap-2" data-toggle="buttons">
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="addStyle('professional business presentation')">
                                    <i class="bi bi-briefcase me-1"></i>Business
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="addStyle('technical diagram illustration')">
                                    <i class="bi bi-diagram-3 me-1"></i>Technical
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="addStyle('data visualization chart')">
                                    <i class="bi bi-graph-up me-1"></i>Data Viz
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="addStyle('modern web interface')">
                                    <i class="bi bi-code-slash me-1"></i>Web Design
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="addStyle('clean minimalist style')">
                                    <i class="bi bi-palette me-1"></i>Minimalist
                                </button>
                            </div>
                        </div>
                        
                        <div class="d-grid">
                            <button class="btn btn-primary btn-lg" type="submit" id="generateBtn">
                                <i class="bi bi-magic me-2"></i>Generate Image
                            </button>
                        </div>
                    </form>
                    
                    <!-- Loading Indicator -->
                    <div id="loadingIndicator" class="text-center mt-4" style="display: none;">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Generating...</span>
                        </div>
                        <p class="mt-2 text-muted">Creating your image...</p>
                    </div>
                    
                    <!-- Error Display -->
                    {% if error %}
                    <div class="alert alert-danger mt-4" role="alert">
                        <i class="bi bi-exclamation-triangle me-2"></i>{{ error }}
                    </div>
                    {% endif %}
                    
                    <!-- Generated Image Display -->
                    {% if image_url %}
                    <div class="mt-4">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">Generated Image</h6>
                                <div class="btn-group btn-group-sm">
                                    <a href="{{ image_url }}" class="btn btn-outline-primary" download target="_blank">
                                        <i class="bi bi-download me-1"></i>Download
                                    </a>
                                    <button class="btn btn-outline-secondary" onclick="copyImageUrl('{{ image_url }}')">
                                        <i class="bi bi-link me-1"></i>Copy URL
                                    </button>
                                </div>
                            </div>
                            <div class="card-body text-center">
                                <img src="{{ image_url }}" class="img-fluid rounded shadow" 
                                     style="max-width: 100%; max-height: 600px;" alt="Generated image">
                                
                                {% if prompt %}
                                <div class="mt-3">
                                    <small class="text-muted">
                                        <strong>Prompt:</strong> {{ prompt }}
                                    </small>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <!-- Sample Prompts -->
                    <div class="mt-4">
                        <h6><i class="bi bi-lightbulb me-2"></i>Sample Prompts</h6>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="card-title"><i class="bi bi-graph-up me-1"></i>Data Science</h6>
                                        <ul class="small mb-0">
                                            <li>Machine learning model accuracy chart</li>
                                            <li>Data pipeline architecture diagram</li>
                                            <li>Statistical analysis visualization</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="card-title"><i class="bi bi-code-slash me-1"></i>Web Development</h6>
                                        <ul class="small mb-0">
                                            <li>Modern website mockup design</li>
                                            <li>API integration flowchart</li>
                                            <li>Responsive layout wireframe</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="card-title"><i class="bi bi-bar-chart me-1"></i>Business Intelligence</h6>
                                        <ul class="small mb-0">
                                            <li>Executive dashboard mockup</li>
                                            <li>KPI tracking interface design</li>
                                            <li>Business report cover page</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function addStyle(style) {
    const textarea = document.getElementById('user_input');
    const currentValue = textarea.value.trim();
    
    if (currentValue) {
        textarea.value = `${currentValue}, ${style} style`;
    } else {
        textarea.value = `${style} style`;
    }
    textarea.focus();
}

function copyImageUrl(url) {
    navigator.clipboard.writeText(url).then(() => {
        showToast('Image URL copied to clipboard!', 'success');
    }).catch(() => {
        showToast('Failed to copy URL', 'danger');
    });
}

// Form submission handling
// Enhanced form submission with better error handling
document.getElementById('imageForm').addEventListener('submit', function(e) {
    const loadingIndicator = document.getElementById('loadingIndicator');
    const generateBtn = document.getElementById('generateBtn');
    const userInput = document.getElementById('user_input');
    
    // Validate input
    if (userInput.value.trim().length < 10) {
        e.preventDefault();
        showToast('Please provide a more detailed description (at least 10 characters)', 'warning');
        return;
    }
    
    // Show loading state
    loadingIndicator.style.display = 'block';
    generateBtn.disabled = true;
    generateBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Generating...';
    
    // Add timeout warning
    setTimeout(() => {
        if (generateBtn.disabled) {
            showToast('Generation is taking longer than usual. Please wait...', 'info');
        }
    }, 10000);
    
    // Reset on error (this will be called if page reloads with error)
    setTimeout(() => {
        loadingIndicator.style.display = 'none';
        generateBtn.disabled = false;
        generateBtn.innerHTML = '<i class="bi bi-magic me-2"></i>Generate Image';
    }, 30000);
});

// Add retry button functionality
function retryImageGeneration() {
    document.getElementById('imageForm').submit();
}

// Suggest prompt improvements
function suggestPromptImprovements(prompt) {
    const suggestions = [
        "Try being more specific about style and mood",
        "Add details about colors, lighting, or composition", 
        "Specify if you want realistic, artistic, or technical style",
        "Keep prompts under 200 characters for better results"
    ];
    
    return suggestions;
}

// Auto-resize textarea
document.getElementById('user_input').addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = (this.scrollHeight) + 'px';
});
</script>

{% endblock %}